<?php

/**
 * EncashLeaveTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class EncashLeaveTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object EncashLeaveTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('EncashLeave');
    }
    
    public static function getEncashedLeaveForYear($empno,$year){
        $total=0;
        $leaves= Doctrine_Query::create()->from ('EncashLeave')
                             ->where(" DATE_FORMAT(`date_effected`,'%Y') = '$year' and employee_id='$empno' ")
      ->fetchArray();
  foreach ($leaves as $encashed) {
         $total+=$encashed['days_encashed'];
      }
      return $total;
    }
    
     public static function getEncashedLeaveForMonth($empno,$monthyear){
        $total=0;
        $leaves= Doctrine_Query::create()->from ('EncashLeave')
                             ->where(" DATE_FORMAT(`date_effected`,'%m-%Y') = '$monthyear' and employee_id='$empno' and `paid_out`=0 ")
      ->fetchArray();
  foreach ($leaves as $encashed) {
         $total+=$encashed['days_encashed'];
      }
      return $total;
    }
    
    public static function updateLeaveEncashment($empno,$monthyear){
    
          $payrollmonth= Doctrine_Query::create()->from ('EncashLeave')
            ->where(" DATE_FORMAT(`date_effected`,'%m-%Y') = '$monthyear' and employee_id='$empno' ")
      ->fetchArray();
         
      $payrollmonthnew=self::getInstance()->find($payrollmonth[0]['id']);
         
          $payrollmonthnew->paid_out=1;
          $payrollmonthnew->save();
          
     }
    
    public static function removeLeaveEncashment($empno,$year,$days){
    
          $payrollmonth= Doctrine_Query::create()
                  ->delete()
                  ->from ('EncashLeave')
            ->where(" DATE_FORMAT(`date_effected`,'%Y') = '$year' and employee_id='$empno' and `days_encashed`='$days' and paid_out=0 ")
        ->execute();
         
               
     }
}