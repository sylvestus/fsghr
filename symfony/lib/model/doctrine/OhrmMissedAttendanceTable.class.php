<?php

/**
 * OhrmMissedAttendanceTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class OhrmMissedAttendanceTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object OhrmMissedAttendanceTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('OhrmMissedAttendance');
    }
    
     public static function deleteMissedAttendance($day,$empnumber,$monthyear){
        try {
             $deletequery=  self::getInstance()
  ->createQuery()
  ->delete()
  ->where(" `day_missed`=$day")
   ->andWhere(" `emp_number`=$empnumber")
                       ->andWhere(" `monthyear`='$monthyear'")
  ->execute();
            return true;
        } catch (Exception $e) {
            throw new DaoException($e->getMessage());
        }
    }
    
    public static function getMissedDaysOfMonth($monthandyear){
               $results=  self::getInstance()
  ->createQuery()
                       ->select()
                ->where(" `monthyear` like '%$monthandyear%'")
                       ->fetchArray();
               
               return $results;
    }
    
    public static function getMissedDayOfMonth($day,$empnumber,$monthyear){
               $result=  self::getInstance()
  ->createQuery()
                       ->select()
                ->where(" `day_missed`=$day")
   ->andWhere(" `emp_number`=$empnumber")
                       ->andWhere(" `monthyear`='$monthyear'")
               ->fetchOne();
               if(is_object($result)){
               return $result->emp_number;
               }
               else{
                   return 0;
               }
    }
    
    
    public static function getMissedDay($day,$empnumber,$monthyear){
               $result=  self::getInstance()
  ->createQuery()
                       ->select()
                ->where(" `day_missed`=$day")
   ->andWhere(" `emp_number`=$empnumber")
                       ->andWhere(" `monthyear`='$monthyear'")
               ->fetchOne();
               if(is_object($result)){
               return $result;
               }
               else{
                   return 0;
               }
    }
    
    
    
    public static function getEmployeeMissedDaysOfMonth($empnumber,$monthyear){

           $result=  self::getInstance()
  ->createQuery()
                       ->select()
               
   ->where(" `emp_number`=$empnumber")
                       ->andWhere(" `monthyear`='$monthyear'")
               ->count();
           
           if($result){
           
               return $result;
           }
           else{
               return 0;
           }
    }
    
    
     public static function deleteMissedAttendanceForMonth($monthyear,$empno=""){
         if(!$empno){
          $q = Doctrine_Query :: create()
                            ->delete()
                            ->from('OhrmMissedAttendance')
                            ->where("`monthyear` = '$monthyear'");
         }
         else{
              $q = Doctrine_Query :: create()
                            ->delete()
                            ->from('OhrmMissedAttendance')
                            ->where("`monthyear` = '$monthyear'")
                      ->andWhere("`emp_number`='$empno'");
         }
                  $result=$q ->execute();  
                  if($result){
                      return TRUE;
                  }
                  else{
                      return FALSE;
                  }
       }
    
    
}