<?php

/**
 * HsHrEmpLocationsTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class HsHrEmpLocationsTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object HsHrEmpLocationsTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('HsHrEmpLocations');
    }
    
     //employees in a location
      public static function findEmployeesInLocation($location){
          $employees=array();
       
        $employeesinlocation = Doctrine_Query::create()
                            ->from('HsHrEmpLocations')
                            ->where('location_id = ?', $location)
                                 
                            ->fetchArray();
        foreach ($employeesinlocation as $employee){
            array_push($employees, $employee["emp_number"]);
        }
        
       // die(print_r($employees));
        return $employees;
    }
    
    
    public static function findEmployeeLocation($empno){
        OhrmLocationTable::getInstance();
        $q = Doctrine_Query::create()
                            ->from('HsHrEmpLocations he')
                            ->leftJoin('he.OhrmLocation l on he.location_id=l.id')
                            ->where('he.emp_number = ?',$empno);
       $location=$q->fetchArray();
      
       if(count($location)>0){
           return $location[0]["OhrmLocation"]["name"];
       }
       else{
           return "Not given";
       }
    }
     public static function findEmployeeLocationId($empno){
        OhrmLocationTable::getInstance();
        $q = Doctrine_Query::create()
                            ->from('HsHrEmpLocations he')
                            ->leftJoin('he.OhrmLocation l on he.location_id=l.id')
                            ->where('he.emp_number = ?', $empno);
       $location=$q->fetchArray();
      
       if(count($location)>0){
           return $location[0]["OhrmLocation"]["id"];
       }
       else{
           return "Not given";
       }
    }
    
    static function updateEmployeeLocation($empnumber,$location){
       
      
        $q = Doctrine_Query :: create()->update('HsHrEmpLocations')
                            ->set('location_id', '?', $location)
                            ->where('emp_number = ?', $empnumber);
       $result=$q->execute();
       
            
           
    }
    
    static function addEmployeeLocation($empnumber,$location){
        $em = Doctrine_Manager::connection();
if($empnumber && $location){
    $q = Doctrine_Query::create()->delete('HsHrEmpLocations')
                                         ->where('emp_number = ?', $empnumber);
    $q->execute();
        $RAW_QUERY = 'INSERT INTO hs_hr_emp_locations(emp_number,location_id) VALUES ("'.$empnumber.'","'.$location.'")';
        
        $statement = $em->prepare($RAW_QUERY);
        $result=$statement->execute();
      
     
            return $result;
}
    }
    
}